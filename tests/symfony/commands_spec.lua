local commands = require("symfony.commands")
local assert = require("luassert")
local fixturesLoader = require("tests.fixtures.load")

describe("commands", function()
  before_each(function()
    commands.clear_storage()
  end)

  it("find by name", function()
    local fake_dump = fixturesLoader.commands()
    commands.update_storage(fake_dump)
    local actual = commands.find_by_name("about")
    assert.is_not_nil(actual)
  end)

  it("not found", function()
    local fake_dump = fixturesLoader.commands()
    commands.update_storage(fake_dump)
    local actual = commands.find_by_name("bad_name")
    assert.is_nil(actual)
  end)

  it("filter by name", function()
    local fake_dump = fixturesLoader.commands()
    commands.update_storage(fake_dump)
    local actual = commands.filter_by_name("cache")
    local actual_count = vim.tbl_count(actual)
    assert.is.equal(actual_count, 7)
  end)
end)
